# docker-compose.yml
# ОПИСАНИЕ: Улучшенная и более надежная конфигурация для вашего Astro-приложения.
# Теперь здесь явно прописаны переменные окружения и команда для запуска
# производственного сервера Astro.

services:
  astro-app:
    # Используем Dockerfile из текущей директории для сборки образа
    build: .
    container_name: avpdev-astro-app
    restart: unless-stopped

    # Пробрасываем переменные окружения из .env файла напрямую в контейнер.
    # Это самый надежный способ для Astro SSR в Docker.
    env_file:
      - .env

    # Указываем Node.js серверу слушать все сетевые интерфейсы (0.0.0.0)
    # внутри контейнера. Это обязательно для доступа извне.
    environment:
      - HOST=0.0.0.0
      - PORT=3000

    # Пробрасываем порт 3000 из контейнера на порт 3000 вашего хост-компьютера.
    # Формат: "ХОСТ:КОНТЕЙНЕР"
    ports:
      - "3000:3000"
