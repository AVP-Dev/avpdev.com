---
import { allProjects as PROJECTS_DATA } from '../../data/projects';
import PortfolioCard from '../PortfolioCard.astro';

const PROJECTS_PER_PAGE = 3;
// Безопасная проверка и подготовка данных
const allProjects = Array.isArray(PROJECTS_DATA) ? PROJECTS_DATA : [];
const hasProjects = allProjects.length > 0;
---

<section id="portfolio" aria-labelledby="portfolio-title">
  <div class="container">
    <h2 id="portfolio-title" class="section-title fade-in" data-lang="portfolio_h2">
      Избранные <span class="gradient-text">Проекты</span>
    </h2>

    {hasProjects ?
    (
      <>
        <div class="portfolio-filters fade-in" role="tablist" aria-label="Фильтры портфолио">
          <button class="filter-btn active" data-filter="all" data-lang="filter_all" role="tab" aria-selected="true">Все</button>
          <button class="filter-btn" data-filter="sites" data-lang="filter_sites" role="tab" aria-selected="false">Сайты</button>
          <button class="filter-btn" data-filter="apps" data-lang="filter_apps" role="tab" aria-selected="false">Веб-приложения</button>
        </div>

        <div id="main-portfolio-grid" class="portfolio-grid" aria-live="polite">
          {/* Рендерим все карточки сразу, но скрываем лишние */}
          {allProjects.map((project, index) => (
            <div class:list={["portfolio-card-wrapper", { 'is-hidden': index >= PROJECTS_PER_PAGE }]}>
              <PortfolioCard {...project} />
            </div>
          ))}
        </div>

        <div class="show-more-container">
          <button 
            id="show-more-btn" 
            class:list={["cta-button", { 'is-hidden': allProjects.length <= PROJECTS_PER_PAGE }]}
            data-lang="show_more" 
            type="button"
          >
            Показать еще
          </button>
        </div>
      </>
    ) : (
      <p class="muted" id="portfolio-empty">
        Проекты для отображения отсутствуют.
      </p>
    )}
  </div>
</section>

<style>
  .portfolio-card-wrapper.is-hidden {
    display: none;
  }
  .show-more-container button.is-hidden {
    display: none;
  }
</style>

<!-- ИЗМЕНЕНО: Удаляем импорт, так как вся логика теперь в main.ts -->
<script>
  // Этот скрипт больше не нужен здесь, так как `main.ts` управляет всем.
</script>

