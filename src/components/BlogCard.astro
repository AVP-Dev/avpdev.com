---
// src/components/BlogCard.astro
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import { getLangFromUrl } from "../i18n/utils";

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const lang = getLangFromUrl(Astro.url);

const formattedDate = new Date(post.data.pubDate).toLocaleDateString(lang, {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<a
  href={`/${lang}/blog/${post.slug.split("/")[1]}`}
  class="portfolio-card blog-card-link"
  data-title={post.data.title.toLowerCase()}
  data-description={post.data.description.toLowerCase()}
  data-tags={post.data.tags.join(",").toLowerCase()}
>
  {
    post.data.heroImage ? (
      <div class="portfolio-image blog-card-image">
        <Image
          src={post.data.heroImage}
          alt={`Обложка статьи: ${post.data.title}`}
          widths={[200, 400, 800]}
          sizes="(max-width: 600px) 100vw, 400px"
          loading="lazy"
          decoding="async"
          style="object-fit: cover; width: 100%; height: 100%;"
        />
      </div>
    ) : (
      <div class="portfolio-image blog-card-image-placeholder" />
    )
  }
  <div class="portfolio-info">
    <p class="blog-card-date">{formattedDate}</p>
    <h3 class="blog-card-title">{post.data.title}</h3>

    <p class="blog-card-desc">{post.data.description}</p>
    <div class="portfolio-tags">
      {post.data.tags.slice(0, 3).map((tag) => <span class="tag">{tag}</span>)}
    </div>
  </div>
</a>
