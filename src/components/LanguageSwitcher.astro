---
// src/components/LanguageSwitcher.astro
import { getLangFromUrl } from '../i18n/utils';

const lang = getLangFromUrl(Astro.url);
const locales = ['ru', 'en'];

// Логика получения пути для другого языка
// Если мы на /ru/about, то pathWithoutLang будет /about
let pathWithoutLang = Astro.url.pathname;
if (pathWithoutLang.startsWith(`/${lang}/`)) {
    pathWithoutLang = pathWithoutLang.replace(`/${lang}/`, '/');
} else if (pathWithoutLang === `/${lang}` || pathWithoutLang === `/${lang}/`) {
    pathWithoutLang = '/';
}
---
<div class="lang-switcher">
    {locales.map((locale, index) => {
        const isActive = locale === lang;
        // Просто формируем ссылку /ru/... или /en/...
        const url = `/${locale}${pathWithoutLang === '/' ? '' : pathWithoutLang}`;
        
        return (
            <>
                {isActive ? (
                    <button class="lang-btn active">{locale.toUpperCase()}</button>
                ) : (
                    <a href={url} class="lang-btn">{locale.toUpperCase()}</a>
                )}
                {index < locales.length - 1 && <span class="lang-separator">|</span>}
            </>
        )
    })}
</div>